<!doctype html>
<html>
<head>{include file ='library/admin_html_head.lbi'}</head>

<body class="iframe_body">
	<div class="warpper">
    	<div class="title"><a href="group_buy.php?act=list" class="s-back">{$lang.back}</a>数据库管理 - {$ur_here}</div>
        <div class="content">
        	<div class="explanation" id="explanation">
            	<div class="ex_tit"><i class="sc_icon"></i><h4>使用说明：</h4><span id="explanationZoom" title="使用说明"></span></div>
                <ul>
                	<li>修改表前缀之后，请将根目录下的 data/config.php 文件中的 $prefix 变量的值也改成 "修改后表前缀"</li>
                </ul>
            </div>
            <div class="flexilist">
                <div class="common-content">
                    <div class="mian-info">
						<div class="list-div">
						当前需要修改的数据表有{$record_count|default:0}条
						</div>
						<div style=" width:100px; height:10px; clear:both; overflow:hidden;"></div>
						<div class="list-div">
						<table id="listTable">
							<tr>
								<th width="10%"><div class="tDiv">编号</div></th>
								<th width="15%"><div class="tDiv">当前表前缀</div></th>
								<th width="15%"><div class="tDiv">修改后表前缀</div></th>
								<th width="60%"><div class="tDiv">SQL语句</div></th>
							</tr>
						</table>
						</div>
                    </div>
                </div>
            </div>
		</div>
	</div>
	{include file ='library/pagefooter.lbi'}
    {insert_scripts files="jquery.purebox.js"}
    <script type="text/javascript">
        $(function(){
            start({$page});
			ajax_title();
        });
        
        function start(page)
        {
            Ajax.call('table_prefix.php?act=ajax_update', 'page=' + page, start_response, 'POST', 'JSON');
        }
        
        /**
         * 处理反馈信息
         * @param: result
         * @return
         */
        function start_response(result)
        {
            if(result.list){
                var tbl = document.getElementById("listTable"); //获取表格对象
                var row = tbl.insertRow(-1);
                
                cell = row.insertCell(0);
                cell.innerHTML = "<div class='tDiv'>"+result.filter_page+"</div>";
                cell = row.insertCell(1);
                cell.innerHTML = "<div class='tDiv'>"+result.list.prefix+"</div>";
                cell = row.insertCell(2);
                cell.innerHTML = "<div class='tDiv'>"+result.list.new_prefix+"</div>";
                cell = row.insertCell(3);
                cell.innerHTML = "<div class='tDiv red'>" + result.list.edit_table + "</div>";
                
                if(result.is_stop == 1){
                    start(result.page);
                }	
            }
            
            if(result.is_stop == 0){
				$("#title_name").addClass("red");
                $("#title_name").html("已完成便前缀修改，请关闭该窗口！");
            }else{
				$("#title_name").html("正在修改表前缀中，请勿关闭该窗口！");
			}
        }
    </script>
</body>
</html>